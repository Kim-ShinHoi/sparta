<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Head content, including styles and scripts -->
    <style>
      /* 꾸미기 */
      .card {
        border: 1px solid #dee2e6;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
      }

      .card:hover {
        transform: scale(1.00);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }

      .acquisition-card {
        background-color: rgba(173, 216, 230, 0.8); /* Light Blue tint */
      }

      /* Customize other elements as needed */
      body {
        background-color: #f8f9fa; /* Light gray background */
      }

      .hero {
        background-color: #343a40; /* Dark background color */
        color: #ffffff; /* White text color */
      }

      .btn-primary {
        background-color: #007bff; /* Bootstrap primary button color */
        border-color: #007bff;
      }

      .btn-primary:hover {
        background-color: #0056b3; /* Darker shade on hover */
        border-color: #0056b3;
      }
    </style>
    <!-- Include Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.8/firebase-database.js"></script>
    <script>
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      // Get a reference to the database service
      const database = firebase.database();
    </script>
  </head>

  <body>
    <div class="hero bg-dark text-center py-5">
      <h1 class="text-white">반곡중학교 분실물센터</h1>
      <h2 class="text-white">잃어버린 물건을 서로 찾아주는 반곡인</h2>
    </div>

    <!-- Bootstrap Card - 습득 -->
    <div class="container mt-5">
      <div class="card mb-3 acquisition-card">
        <!-- Image upload input -->
        <input type="file" id="acquisitionImageInput" class="card-img-top" accept="image/*" onchange="displayImage('acquisition')">
        <div class="card-body">
          <input type="text" class="card-title form-control mb-2" placeholder="제목 입력">
          <textarea class="card-text form-control mb-2" placeholder="내용 입력" rows="2"></textarea>
          <input type="text" class="form-control" placeholder="찾아갈 곳 입력">
          <button class="btn btn-primary mt-3" onclick="submitCard('acquisition')">Submit</button>
        </div>
      </div>

      <!-- Display selected image for 습득 -->
      <div id="acquisitionImagePreview" class="mt-3"></div>
    </div>

    <!-- Display selected image for 분실 -->
    <div id="lossImagePreview" class="mt-3"></div>

    <div id="cardContainer" class="container mt-5"></div>

    <script>
      // Array to store submitted card data
      let submittedCards = [];

      // Function to display selected image
      function displayImage(type) {
        const input = type === 'acquisition' ? document.getElementById('acquisitionImageInput') : document.getElementById('lossImageInput');
        const preview = type === 'acquisition' ? document.getElementById('acquisitionImagePreview') : document.getElementById('lossImagePreview');
        
        if (input.files && input.files[0]) {
          const reader = new FileReader();
          
          reader.onload = function(e) {
            preview.innerHTML = `<img src="${e.target.result}" class="img-fluid" alt="Selected Image">`;
          };
          
          reader.readAsDataURL(input.files[0]);
        }
      }

      // Function to submit the card
      function submitCard(type) {
        const title = type === 'acquisition' ? document.querySelector('#acquisitionImageInput + .card-body .card-title').value : document.querySelector('#lossImageInput + .card-body .card-title').value;
        const content = type === 'acquisition' ? document.querySelector('#acquisitionImageInput + .card-body .card-text').value : document.querySelector('#lossImageInput + .card-body .card-text').value;
        const location = type === 'acquisition' ? document.querySelector('#acquisitionImageInput + .card-body .form-control').value : document.querySelector('#lossImageInput + .card-body .form-control').value;
        const imageSrc = type === 'acquisition' ? document.getElementById('acquisitionImagePreview').querySelector('img')?.src : document.getElementById('lossImagePreview').querySelector('img')?.src;

        // Create a new card
        const newCard = document.createElement('div');
        newCard.className = `card mb-3 ${type === 'acquisition' ? 'acquisition-card' : 'loss-card'}`;
        newCard.innerHTML = `
          <div class="card-body">
            <h5 class="card-title">${title}</h5>
            <p class="card-text">${content}</p>
            <p class="card-text"><strong>찾아갈 곳:</strong> ${location}</p>
            <div class="mt-3">
              ${imageSrc ? `<img src="${imageSrc}" class="img-fluid thumbnail" alt="Thumbnail Image">` : ''}
            </div>
          </div>
        `;

        // Append the new card to the container
        const cardContainer = document.getElementById('cardContainer');
        cardContainer.insertBefore(newCard, cardContainer.firstChild);

        // Save card data to Firebase
        saveToFirebase();

        // Reset input fields
        document.getElementById(`${type}ImageInput`).value = '';
        document.querySelector(`#${type}ImageInput + .card-body .card-title`).value = '';
        document.querySelector(`#${type}ImageInput + .card-body .card-text`).value = '';
        document.querySelector(`#${type}ImageInput + .card-body .form-control`).value = '';
        document.getElementById(`${type}ImagePreview`).innerHTML = '';
      }

      // Function to save card data to Firebase
      function saveToFirebase() {
        // Push the submittedCards array to the 'cards' node in the database
        database.ref('cards').set(submittedCards);
      }

      // Function to load card data from Firebase
      function loadFromFirebase() {
        // Listen for changes in the 'cards' node and update submittedCards accordingly
        database.ref('cards').on('value', (snapshot) => {
          const data = snapshot.val();
          if (data) {
            submittedCards = data;
            submittedCards.forEach(cardData => {
              createCardFromData(cardData);
            });
          }
        });
      }

      // Function to create a card from saved data
      function createCardFromData(cardData) {
        const newCard = document.createElement('div');
        newCard.className = `card mb-3 ${cardData.type === 'acquisition' ? 'acquisition-card' : 'loss-card'}`;
        newCard.innerHTML = `
          <div class="card-body">
            <h5 class="card-title">${cardData.title}</h5>
            <p class="card-text">${cardData.content}</p>
            <p class="card-text"><strong>찾아갈 곳:</strong> ${cardData.location}</p>
            <div class="mt-3">
              ${cardData.imageSrc ? `<img src="${cardData.imageSrc}" class="img-fluid thumbnail" alt="Thumbnail Image">` : ''}
            </div>
          </div>
        `;

        const cardContainer = document.getElementById('cardContainer');
        cardContainer.insertBefore(newCard, cardContainer.firstChild);
      }

      // Load saved card data when the page is loaded
      window.addEventListener('load', loadFromFirebase);
    </script>
  </body>
</html>
